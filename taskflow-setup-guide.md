# TaskFlow AI - Complete Setup Guide (React Router v7)

## Prerequisites

Before starting, ensure you have:
- **Bun** v1.0+ installed (`curl -fsSL https://bun.sh/install | bash`)
- **Node.js** v18+ (for Convex CLI)
- **Git** for version control
- A **Convex** account (free tier works)
- An **OpenAI API** key (for AI features)

> **Note:** Remix v2 has been merged into React Router v7. This guide uses the latest React Router.

---

## Step 1: Project Initialization

### 1.1 Create New React Router Project

```bash
# Create new React Router app (Remix v2 successor)
bunx create-react-router@latest .

# When prompted, choose:
# - Template: React Router App
# - TypeScript: Yes
# - Package manager: Bun
# - Install dependencies: Yes

# Note: We're using "." to initialize in current directory (TaskManga)
```

### 1.2 Initialize Convex

```bash
# Install Convex
bun add convex

# Initialize Convex in your project
bunx convex dev --once

# This will:
# 1. Create a convex/ directory
# 2. Prompt you to create/login to Convex account
# 3. Create a new Convex project
# 4. Generate convex/ folder with _generated/ files
```

### 1.3 Install Core Dependencies

```bash
# Development dependencies (install these first)
bun add -D @types/node
bun add -D tailwindcss postcss autoprefixer

# Initialize Tailwind (after installing it)
bun tailwindcss init -p

# Core dependencies
bun add neverthrow
bun add @radix-ui/react-slot clsx tailwind-merge
bun add lucide-react
bun add @dnd-kit/core @dnd-kit/sortable @dnd-kit/utilities
```

---

## Step 2: Environment Configuration

### 2.1 Create Environment Files

Create `.env` file in project root:

```bash
# .env
CONVEX_DEPLOYMENT=dev:your-deployment-name  # Auto-generated by Convex
OPENAI_API_KEY=sk-your-openai-key-here
SESSION_SECRET=your-random-secret-here-min-32-chars
```

Create `.env.local` for local overrides:

```bash
# .env.local
CONVEX_DEPLOYMENT=dev:your-local-deployment
```

### 2.2 Update .gitignore

```bash
# Add to .gitignore
.env
.env.local
.convex
node_modules/
.cache/
build/
public/build/
```

---

## Step 3: Configure Convex

### 3.1 Set Up Convex Schema

Create `convex/schema.ts`:

```typescript
import { defineSchema, defineTable } from "convex/server";
import { v } from "convex/values";

export default defineSchema({
  users: defineTable({
    name: v.string(),
    email: v.string(),
    clerkId: v.string(),
    avatar: v.optional(v.string()),
  })
    .index("by_clerk_id", ["clerkId"])
    .index("by_email", ["email"]),

  workspaces: defineTable({
    name: v.string(),
    ownerId: v.id("users"),
    settings: v.object({
      aiEnabled: v.boolean(),
    }),
  }).index("by_owner", ["ownerId"]),

  boards: defineTable({
    workspaceId: v.id("workspaces"),
    name: v.string(),
    type: v.union(
      v.literal("kanban"),
      v.literal("sprint"),
      v.literal("calendar")
    ),
  }).index("by_workspace", ["workspaceId"]),

  tasks: defineTable({
    boardId: v.id("boards"),
    title: v.string(),
    description: v.optional(v.string()),
    status: v.string(),
    priority: v.union(
      v.literal("low"),
      v.literal("medium"),
      v.literal("high")
    ),
    assigneeId: v.optional(v.id("users")),
    position: v.number(),
  })
    .index("by_board", ["boardId"])
    .index("by_assignee", ["assigneeId"]),
});
```

### 3.2 Push Schema to Convex

```bash
# Push schema to Convex
bunx convex dev

# Leave this running in a terminal
# It will watch for changes and auto-deploy
```

---

## Step 4: Configure Remix

### 4.1 Update react-router.config.ts

React Router v7 uses a different config file:

```typescript
// react-router.config.ts
import type { Config } from "@react-router/dev/config";

export default {
  // App directory
  appDirectory: "app",
  
  // Ignore route files starting with .
  ignoredRouteFiles: ["**/*.css", "**/*.test.{ts,tsx}"],
  
  // Server build directory
  serverBuildFile: "index.js",
  
  // Tailwind support
  tailwind: true,
} satisfies Config;
```

### 4.2 Configure Tailwind

Update `tailwind.config.ts`:

```typescript
import type { Config } from "tailwindcss";

export default {
  content: ["./app/**/*.{js,jsx,ts,tsx}"],
  theme: {
    extend: {
      colors: {
        border: "hsl(var(--border))",
        background: "hsl(var(--background))",
        foreground: "hsl(var(--foreground))",
      },
    },
  },
  plugins: [],
} satisfies Config;
```

### 4.3 Set Up Convex Client

Create `app/lib/convex.client.ts`:

```typescript
import { ConvexReactClient } from "convex/react";

const convexUrl = process.env.CONVEX_DEPLOYMENT || "";

if (!convexUrl) {
  throw new Error("Missing CONVEX_DEPLOYMENT environment variable");
}

export const convex = new ConvexReactClient(convexUrl);
```

### 4.4 Update Root Layout

Update `app/root.tsx`:

```typescript
import {
  Links,
  Meta,
  Outlet,
  Scripts,
  ScrollRestoration,
} from "react-router";
import { ConvexProvider, ConvexReactClient } from "convex/react";
import type { Route } from "./+types/root";
import "./tailwind.css";

const convex = new ConvexReactClient(
  typeof window !== "undefined" 
    ? (window as any).ENV.CONVEX_DEPLOYMENT 
    : ""
);

export function loader() {
  return {
    ENV: {
      CONVEX_DEPLOYMENT: process.env.CONVEX_DEPLOYMENT,
    },
  };
}

export function Layout({ children }: { children: React.ReactNode }) {
  return (
    <html lang="en">
      <head>
        <meta charSet="utf-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <Meta />
        <Links />
      </head>
      <body>
        {children}
        <ScrollRestoration />
        <Scripts />
      </body>
    </html>
  );
}

export default function App({ loaderData }: Route.ComponentProps) {
  return (
    <ConvexProvider client={convex}>
      <Outlet />
    </ConvexProvider>
  );
}
```

---

## Step 5: Create Initial CRUD Operations

### 5.1 Task Mutations

Create `convex/tasks.ts`:

```typescript
import { mutation, query } from "./_generated/server";
import { v } from "convex/values";

export const create = mutation({
  args: {
    boardId: v.id("boards"),
    title: v.string(),
    status: v.string(),
    position: v.number(),
  },
  handler: async (ctx, args) => {
    return await ctx.db.insert("tasks", {
      ...args,
      priority: "medium",
    });
  },
});

export const list = query({
  args: { boardId: v.id("boards") },
  handler: async (ctx, args) => {
    return await ctx.db
      .query("tasks")
      .withIndex("by_board", (q) => q.eq("boardId", args.boardId))
      .collect();
  },
});

export const update = mutation({
  args: {
    id: v.id("tasks"),
    title: v.optional(v.string()),
    status: v.optional(v.string()),
    position: v.optional(v.number()),
  },
  handler: async (ctx, args) => {
    const { id, ...updates } = args;
    await ctx.db.patch(id, updates);
  },
});
```

---

## Step 6: Create Helper Utilities

### 6.1 Neverthrow Helpers

Create `app/lib/utils/result.ts`:

```typescript
import { Result, ok, err } from "neverthrow";

export type AppError =
  | { type: "NOT_FOUND"; entity: string }
  | { type: "UNAUTHORIZED"; message: string }
  | { type: "VALIDATION_ERROR"; fields: Record<string, string> }
  | { type: "NETWORK_ERROR"; message: string }
  | { type: "UNKNOWN_ERROR"; message: string };

export function handleError(error: unknown): AppError {
  if (error instanceof Error) {
    return { type: "UNKNOWN_ERROR", message: error.message };
  }
  return { type: "UNKNOWN_ERROR", message: "An unexpected error occurred" };
}

export async function tryCatch<T>(
  fn: () => Promise<T>
): Promise<Result<T, AppError>> {
  try {
    const result = await fn();
    return ok(result);
  } catch (error) {
    return err(handleError(error));
  }
}
```

### 6.2 CN Utility (Tailwind)

Create `app/lib/utils/cn.ts`:

```typescript
import { clsx, type ClassValue } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}
```

---

## Step 7: Development Scripts

### 7.1 Update package.json

```json
{
  "scripts": {
    "dev": "react-router dev",
    "build": "react-router build",
    "start": "react-router-serve ./build/server/index.js",
    "convex:dev": "convex dev",
    "convex:deploy": "convex deploy",
    "typecheck": "tsc",
    "dev:all": "bun run --parallel dev convex:dev"
  }
}
```

---

## Step 8: Verify Installation

### 8.1 Start Development Servers

```bash
# Terminal 1: Start Convex (watches for changes)
bun run convex:dev

# Terminal 2: Start Remix
bun run dev
```

### 8.2 Test Setup

Create a simple test route at `app/routes/home.tsx`:

```typescript
import { useQuery } from "convex/react";
import { api } from "convex/_generated/api";
import type { Route } from "./+types/home";

export function meta({}: Route.MetaArgs) {
  return [
    { title: "TaskFlow AI" },
    { name: "description", content: "Intelligent Team Workspace" },
  ];
}

export default function Home() {
  const workspaces = useQuery(api.workspaces.list);
  
  return (
    <div className="p-8">
      <h1 className="text-4xl font-bold">TaskFlow AI</h1>
      <p className="mt-4">Setup complete! âœ…</p>
      <pre className="mt-4 p-4 bg-gray-100 rounded">
        {JSON.stringify(workspaces, null, 2)}
      </pre>
    </div>
  );
}
```

Visit `http://localhost:5173` - you should see your app running!

---

## Step 9: Optional Setup

### 9.1 Set Up Authentication (Convex Auth)

```bash
bun add @convex-dev/auth
bunx @convex-dev/auth
```

### 9.2 Add Linting

```bash
bun add -D eslint @typescript-eslint/parser @typescript-eslint/eslint-plugin
bun add -D prettier prettier-plugin-tailwindcss
```

### 9.3 Add Testing

```bash
bun add -D vitest @testing-library/react @testing-library/jest-dom
bun add -D happy-dom
```

---

## Step 10: Deploy (Production)

### 10.1 Deploy Convex

```bash
# Deploy Convex backend
bunx convex deploy --prod

# Get production URL
bunx convex env get CONVEX_DEPLOYMENT --prod
```

### 10.2 Deploy Remix (Example: Vercel)

```bash
# Install Vercel CLI
bun add -g vercel

# Deploy
vercel

# Set environment variables in Vercel dashboard:
# - CONVEX_DEPLOYMENT (production URL)
# - OPENAI_API_KEY
# - SESSION_SECRET
```

---

## Troubleshooting

### Convex not connecting
```bash
# Clear Convex cache
rm -rf .convex
bunx convex dev --once
```

### TypeScript errors
```bash
# Regenerate types
bunx convex dev --once --typecheck disable
```

### Port already in use
```bash
# Kill process on port 5173
lsof -ti:5173 | xargs kill -9
```

---

## Next Steps

1. âœ… Set up authentication
2. âœ… Create workspace and board CRUD
3. âœ… Build Kanban board component
4. âœ… Add real-time presence
5. âœ… Integrate OpenAI for AI features

---

## Quick Reference

```bash
# Start everything
bun run dev:all

# Check Convex dashboard
open https://dashboard.convex.dev

# View logs
bunx convex logs --watch

# Reset database (careful!)
bunx convex data clear
```

ðŸŽ‰ **You're ready to build TaskFlow AI!**